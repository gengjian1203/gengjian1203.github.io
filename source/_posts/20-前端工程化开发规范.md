---
title: 20.前端工程化开发规范
date: 2021-01-03 09:21:51
tags:
  - 代码规范
---

### 规范背景

随着市面上的需求越来越复杂。
个人开发者已无法满足项目版本的开发速度。  
那么团队开发是复杂项目的必然选择。  
不过如何管理研发团队的开发风格，
确保每一行代码都像是`同一个人`编写的。
从而减少团队中代码的沟通成本。  
这是团队开发中重要的一环。

<!-- more -->

### 目录结构规范

```js
.
└── client              // 项目根路径
    ├── config          // webpack相关配置
    └── src             // 源码
        ├── api         // webapi接口
        ├── assets      // 静态资源
        ├── components  // 公共组件
        ├── config      // 项目配置：如环境
        ├── hooks       // 公共Hooks
        ├── pages       // 页面
        ├── redux       // redux
        ├── scss        // 公共样式、UI库样式、主题色、层级管理
        ├── services    // 封装管理器：接口请求器、缓存管理器、图片处理器等
        └── utils       // 公共方法
```

1. 组件设计

   每个组件都是一个文件夹。组件名即为文件夹名。  
   文件夹内包括 index.tsx 以及 index.less。  
   组件内尽量不要使用 redux。  
   所有依赖数据尽量使用 props 传值。  
   内部逻辑实现尽量抽象，不要依赖业务元素。  
   这样以保证其复用性。
   组建内部尽量不要使用页面级生命周期。（待实践）

   组件传入的每个参数都要注释其意义，以及是否必传。  
   `公共组件`放到./client/src/components  
   `局部组件`放到对应页面下的 components 文件夹内

2. 页面设计

   每个页面都是一个文件夹。页面名即为文件夹名。  
   文件夹内包括 components、index.tsx 、 index.less、 index.config.ts

   页面传入的每个参数都要注释其意义，以及是否必传。

### git 管理规范

1. 保证 master 分支代码，是没有风险的，随时可以打包上线。
2. 创建分支的时候，同时绑定该分支的版本号。同步书写该版本的文档。
3. 可通过 gitlab runner 搭建 CI 持续集成。
4. 按照一定语法去 commit，每一条 commit 由以下几部分构成。

```
  修改类型+(影响模块)+:+[bug单号]+问题描述
  如：fix(会员购买页面):[7405-7405]会员等级购买ios购买规避政策
  修改类型分为以下几种：
  feat: 开发新功能
  style: 调整样式
  fix: bug修复
  refactor: 代码重构
  merge: 代码合并
  doc: 书写文档
  config: 调整配置
```

PS:  
 定制版本过多的话，不建议以分支去隔离。  
 随着业务分叉严重，版本更迭时间过长。  
 合代码的时候，任务重，风险大。  
 可考虑通过 webpack 打包不同文件后缀名，进行文件隔离。（待实践）

### 代码编写规范

1. 统一开发环境  
   建议 VSCode+Prettier 自动保存即格式化代码。

2. 事件绑定函数命名规范  
   开头：固定使用 handle  
   中间模块名称：如：Cell、Item  
   尾部事件名称：如：Click、TouchMove  
   例：handleCellClick(e)

3. 自定义函数命名规范  
   通过函数名来知道意义。  
   校验类：check 开头  
   处理类：deal 开头  
   方法类： process 开头  
   渲染类： render 开头

4. 组件命名规范  
   使用名词开头，后接形容词。  
   如：list-select、module-title、panel-bottom。

5. 路由传值  
   由于路由传值都被转为 string 类型。传值 undefined，false，true 等歧义变量，很容易引发隐蔽性 bug。

6. 封装方法传入的参数尽量是对象
   ```ts
   dealDateInfo(params); // good
   dealDateInfo(data, show, tip, success); // bad
   ```
   如果一个函数需要多个参数实现其逻辑，尽量将这些参数组成一个对象。
   这样的好处在于：
   1. 方便定义类型。
   2. 如果部分参数是非必传的情况，方便处理。
   3. 对于编译器减少 push 函数参数的操作

### 开发规范

1. import 书写顺序

   1. 优先引入三方库
   2. 次之引入绝对路径
   3. 最后引入相对路径

   而同级则以引入库的字母顺序排列。

2. 类开发内书写顺序

   1. 优先书写变量相关

      1. 优先书写 构造函数：自定义变量
      2. 其次书写 state、data 的定义
      3. 次之书写 computed
      4. 最后书写 watch

   2. 次之书写函数相关

      1. 优先书写 methods
      2. 其次书写 events 等自定义事件
      3. 次之书写 生命周期
      4. 最后书写自定义函数

   3. 如为 tsx 文件

      1. 自定义 render 函数
      2. 返回的 render 函数

3. TSX 文件书写顺序（待实践）
   思想：

   1. 自定义变量
   2. 自定义函数
   3. 生命周期
   4. 绑定事件函数
   5. 渲染函数
   6. 主渲染函数

   详细：

   1. useRouter
   2. useRef
   3. useState
   4. useMemo
   5. 自定义变量
   6. 自定义方法
   7. useDidShow
   8. useEffect
   9. usePullDownRefresh
   10. useReachBottom
   11. handleXXX 绑定事件
   12. renderXXX 渲染函数
   13. render return() 主渲染函数

4. 善用 CSS 变量

   颜色、字号、边距、边角已经有规定尺寸，常规情况下，不要直接去写数值。会造成 UI 风格不一致。

5. 数据管理

   前端要有自己的数据管理能力。  
   由于组件设计过程中，组件内的变量命名应该是抽象的。  
   那么在接口获取数据之后，  
   都需要将得到的数据，转换为组件内对应的变量位置装好。
   这样，数据处理位置比较居中，同时也能倒逼设计组件更加抽象化。

6. 多条件判断情况

   以`[].includes('')`处理为宜，方便其拓展性。

7. 生命周期的运用

   1. `useEffect`，只用来处理变量
   2. `useDidShow`，用来请求接口数据

### 代码优化

1. 慎用 redux。由于每次变化会触发全局刷新。建议只存储唯一性的值。
2. 与渲染无关的数据尽量不要放在 state 中，可以放在 useRef 中。
3. 善用节流、防抖。usePageScroll 装饰节流、input 装饰防抖。
4. 封装组件的时候，留意不要套多余无意义 View 。以免页面 DOM 层级太深，影响渲染性能。
5. Input 输入框跳位问题。尽量不要对 Input 的 value 二次 setState。
6. 尽量减少页面的跳转交互。
7. 尝试页面处于 loading 状态时候使用骨架屏。

### 项目管理

1. 通过 jsDoc 完善 api 文档
2. 通过 jscpd 判断代码重复率
3. 工具化代码 review 平台
4. 项目管理系统平台
5. 自动化测试

### 后记

本篇部分内容为实际项目已经用到且取得相应成效的方法。  
部分内容为个人见解尚在理论部分，待实践。  
项目规范是一个不断优化、不断完善的长期过程。  
要做到因地制宜，慢慢尝试，找到最适合自己团队的方式，  
这样才能真正提升团队开发效率。  
我也会不断更新该篇文章。
