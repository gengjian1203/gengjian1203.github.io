---
title: 10.关于小程序中安卓与iOS的兼容适配坑
date: 2020-07-10 20:09:51
tags:
  - 微信小程序
  - 机型兼容适配
---

### 小程序兼容适配
机型适配，安卓与iOS系统的兼容，  
是做前端永恒不变的话题。  
现在随着终端设备的五花八门，
系统繁杂，尺寸比各式各样，  
导致前端的适配工作就是一个永远也填不完的神坑。  
随即新建了这个文章，  
用来记录一下自己踩过的兼容适配坑。
  
<!-- more -->
  
### 遇到的坑
#### 小程序中右滑返回
可能由于随着手机屏幕过大，  
在返回交互上，手指够不到左上角的返回键，  
新增了右滑返回的交互。  
设计的初衷是好的，不过坑惨了前端开发人员。  
[“右滑手势返回”能力调整](https://developers.weixin.qq.com/community/develop/doc/000868190489286620a8b27f156c01?highLine=disableSwipeBack)  
微信7.0.5客户端版本之后，页面配置中的 **disableSwipeBack** 属性将不再生效。  
同时也没有api能获取到右划返回的回调。  
  
目前能够想到的办法：  
* 通过产品交互来回避这个返回坑。  
* 通过检测点击屏幕左边边缘，向右滑动这个动作来捕捉这个事件。（但是无法阻止返回上一页面的交互）  
  
#### Textarea标签
关于输入表单，多行文本一般会使用Textarea组件。  
这个时候在样式上，就有文本对齐的坑。  
安卓机型：没有默认内边距，可以正常显示。  
iOS机型：会有默认的padding偏移，且无法置0。  
虽然在微信小程序官方文档中提到了，  
基础库版本2.10.0以上，
新增disable-default-padding属性可以去掉iOS下的默认内边距。  
不过实测之后，发现并没有用。  
  
像是vant这样的ui组件库，
对Textarea封装的Field组件，
在源码上是对ios机型上增加margin-top: -9rpx;样式
只能说是尽量抹除机型的差距。
  
#### 长机型的底部安全距离预留
类似iphoneX长机型将样式填满屏幕的时候会有：  
* 底部圆边被裁掉样式  
* 底部黑色长条遮挡样式  
* 误触发Home Indicator事件  
  
这个时候就需要给底部留出安全的距离。  
可以使用该样式来处理。  
``` css
.safe-bottom {
  padding-bottom: constant(safe-area-inset-bottom); /*兼容 IOS<11.2*/
  padding-bottom: env(safe-area-inset-bottom);      /*兼容 IOS>11.2*/
}
```
因为这个变量是iOS系统内核提供的，  
安卓和开发者工具上用的chromium内核没有这个变量，  
导致这个样式只支持iOS系统，对安卓系统还需要单独处理。  
  
### 后记
未完待续，随时新坑。  
  